<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Alex Psicultor Pro</title>

<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<header>
  <h1>üêü Alex Psicultor Pro</h1>
</header>

<nav>
  <button onclick="App.navigate('dashboard')">Dashboard</button>
  <button onclick="App.navigate('tanques')">Tanques</button>
  <button onclick="App.navigate('financeiro')">Financeiro</button>
  <button onclick="App.navigate('metas')">Metas</button>
</nav>

<main>

<section id="dashboard" class="page active">
  <div id="dashboardContent"></div>
  <canvas id="graficoDashboard" style="max-width:100%;margin-top:20px;"></canvas>
</section>

<section id="tanques" class="page">
  <div id="tanquesContent"></div>
  <button onclick="adicionarTanque()">+ Novo Tanque</button>
</section>

<section id="financeiro" class="page">
  <div id="financeiroContent">
    <div id="areaFinanceiro"></div>
    <button onclick="adicionarLancamento()">+ Novo Lan√ßamento</button>
    <canvas id="graficoFinanceiro" style="max-width:100%;margin-top:20px;"></canvas>
  </div>
</section>

<section id="metas" class="page">
  <div id="metasContent"></div>
</section>

<script>
// ===============================
// APP ALEX PSICULTOR PRO
// ===============================

// ---------- Dados ----------
let tanques = JSON.parse(localStorage.getItem("tanques")) || [];
let lancamentos = JSON.parse(localStorage.getItem("lancamentos")) || [];

// ---------- Salvar ----------
function salvarTanques() { localStorage.setItem("tanques", JSON.stringify(tanques)); }
function salvarLancamentos() { localStorage.setItem("lancamentos", JSON.stringify(lancamentos)); }

// ===============================
// TANQUES
// ===============================
function mostrarTanques() {
    const area = document.getElementById("tanquesContent");
    area.innerHTML = "";
    if(tanques.length===0){ area.innerHTML="<p style='color:white'>Nenhum tanque cadastrado.</p>"; return; }
    tanques.forEach((tanque,index)=>{
        let histHTML=""; if(tanque.historico.length>0){ histHTML="<ul>"; tanque.historico.forEach(h=>{ histHTML+=`<li>${h.data}: ${h.peso} g</li>` }); histHTML+="</ul>"; }
        let racaoHTML=""; if(tanque.historicoRacao.length>0){ racaoHTML="<ul>"; tanque.historicoRacao.forEach(r=>{ racaoHTML+=`<li>${r.data}: ${r.quantidade} kg (R$ ${r.valor.toFixed(2)})</li>` }); racaoHTML+="</ul>"; }
        area.innerHTML+=`
            <div style="background:#1e3a5f; padding:15px; margin:10px; border-radius:10px; color:white;">
                <h3>${tanque.nome}</h3>
                <p><strong>Peixes:</strong> ${tanque.quantidade}</p>
                <p><strong>Peso Atual:</strong> ${tanque.pesoMedio} g</p>
                ${histHTML}
                <p><strong>Ra√ß√£o:</strong></p>${racaoHTML}
                <button onclick="adicionarPesagem(${index})">Adicionar Pesagem</button>
                <button onclick="registrarRacao(${index})" style="background:#ff9800;color:white;margin-left:5px;">Registrar Ra√ß√£o</button>
                <button onclick="removerTanque(${index})" style="background:red;color:white;margin-left:5px;">Excluir</button>
            </div>
        `;
    });
}

function adicionarTanque(){
    const nome=prompt("Nome do tanque:");
    const quantidade=parseInt(prompt("Quantidade de peixes:"));
    const pesoMedio=parseFloat(prompt("Peso m√©dio inicial (g):"));
    if(!nome||!quantidade||!pesoMedio){ alert("Preencha todos os campos corretamente!"); return; }
    tanques.push({nome,quantidade,pesoMedio,historico:[],historicoRacao:[]});
    salvarTanques(); mostrarTanques();
}

function adicionarPesagem(index){
    const novoPeso=parseFloat(prompt("Novo peso m√©dio (g):"));
    const dataPesagem=prompt("Data da pesagem (dd/mm/aaaa):", new Date().toLocaleDateString());
    if(!novoPeso||!dataPesagem){ alert("Digite valores v√°lidos!"); return; }
    const tanque=tanques[index];
    tanque.historico.push({data:dataPesagem,peso:novoPeso});
    tanque.pesoMedio=novoPeso;
    salvarTanques(); mostrarTanques(); alert("Pesagem salva com sucesso!");
}

function registrarRacao(index){
    const tanque=tanques[index];
    const quantidadeRacao=parseFloat(prompt(`Quantos kg de ra√ß√£o para o tanque "${tanque.nome}"?`));
    const valorRacao=parseFloat(prompt("Valor total dessa ra√ß√£o (R$)?"));
    const dataRacao=prompt("Data da ra√ß√£o (dd/mm/aaaa):", new Date().toLocaleDateString());
    if(!quantidadeRacao||!valorRacao||!dataRacao){ alert("Digite valores v√°lidos!"); return; }
    tanque.historicoRacao.push({data:dataRacao,quantidade:quantidadeRacao,valor:valorRacao});
    lancamentos.push({tipo:"sa√≠da",descricao:`Ra√ß√£o tanque ${tanque.nome} - ${quantidadeRacao} kg`,valor:valorRacao,data:dataRacao,gastoRacao:true});
    salvarTanques(); salvarLancamentos(); mostrarTanques(); mostrarFinanceiro(); alert("Ra√ß√£o registrada e adicionada ao financeiro!");
}

function removerTanque(index){ if(confirm("Deseja realmente excluir este tanque?")){ tanques.splice(index,1); salvarTanques(); mostrarTanques(); } }

// ===============================
// FINANCEIRO
// ===============================
function mostrarFinanceiro(){
    const area=document.getElementById("areaFinanceiro");
    area.innerHTML="";
    if(lancamentos.length===0){ area.innerHTML="<p style='color:white'>Nenhum lan√ßamento registrado.</p>"; atualizarGraficoFinanceiro(); return; }
    let saldo=0; let html="<table style='width:100%; color:white; font-size:14px;'><tr><th>Data</th><th>Descri√ß√£o</th><th>Valor</th><th>A√ß√µes</th></tr>";
    lancamentos.forEach((l,index)=>{ saldo+=l.tipo==="entrada"?l.valor:-l.valor; html+=`<tr><td>${l.data}</td><td>${l.descricao}</td><td style="color:${l.tipo==="entrada"?'#4caf50':'#f44336'}">${l.tipo==='entrada'?'+':'-'} R$ ${l.valor.toFixed(2)}${l.gastoRacao?' (Ra√ß√£o)':''}</td><td><button onclick="removerLancamento(${index})" style="background:red;color:white;">üóëÔ∏è</button></td></tr>`; });
    html+="</table>";
    html+=`<p><strong>Saldo Atual:</strong> R$ ${saldo.toFixed(2)}</p>`;
    area.innerHTML=html;
    atualizarGraficoFinanceiro();
}

function adicionarLancamento(){
    const tipo=prompt("Tipo de lan√ßamento (entrada / sa√≠da / ra√ß√£o):").toLowerCase();
    if(tipo!=="entrada"&&tipo!=="sa√≠da"&&tipo!=="ra√ß√£o"){ alert("Digite 'entrada', 'sa√≠da' ou 'ra√ß√£o'"); return; }
    const descricao=prompt("Descri√ß√£o do lan√ßamento:"); if(!descricao){ alert("Digite uma descri√ß√£o"); return; }
    const valor=parseFloat(prompt("Valor do lan√ßamento (R$):")); if(!valor||valor<=0){ alert("Valor inv√°lido"); return; }
    const data=prompt("Data do lan√ßamento (dd/mm/aaaa):", new Date().toLocaleDateString());
    lancamentos.push({tipo:tipo==="ra√ß√£o"?"sa√≠da":tipo,descricao,valor,data,gastoRacao:tipo==="ra√ß√£o"});
    salvarLancamentos(); mostrarFinanceiro();
}

function removerLancamento(index){ if(confirm("Deseja realmente remover este lan√ßamento?")){ lancamentos.splice(index,1); salvarLancamentos(); mostrarFinanceiro(); } }

// ===============================
// DASHBOARD AVAN√áADO
// ===============================
function mostrarDashboard(){
    const area=document.getElementById("dashboardContent");
    area.innerHTML="";
    const labels=[]; const dataLucro=[]; const dataRacao=[]; const dataEntrada=[]; const dataSaida=[];
    tanques.forEach(tanque=>{
        let custoRacao=0; if(tanque.historicoRacao)tanque.historicoRacao.forEach(r=>{custoRacao+=r.valor;});
        const precoVenda=15;
        const pesoAtualKg=tanque.pesoMedio*tanque.quantidade/1000;
        const receita=pesoAtualKg*precoVenda;
        const lucroLiquido=receita-custoRacao;
        area.innerHTML+=`<div style="background:#1e3a5f; padding:15px; margin:10px; border-radius:10px; color:white;"><h3>${tanque.nome}</h3><p>Receita Estimada: R$ ${receita.toFixed(2)}</p><p>Custo Ra√ß√£o: R$ ${custoRacao.toFixed(2)}</p><p><strong>Lucro L√≠quido:</strong> R$ ${lucroLiquido.toFixed(2)}</p></div>`;
        labels.push(tanque.nome); dataLucro.push(lucroLiquido.toFixed(2)); dataRacao.push(custoRacao.toFixed(2));
    });
    // Gr√°fico
    const ctx=document.getElementById("graficoDashboard").getContext('2d');
    if(window.graficoDashboardInstance) window.graficoDashboardInstance.destroy();
    window.graficoDashboardInstance=new Chart(ctx,{type:'bar',data:{labels,datasets:[{label:'Lucro L√≠quido (R$)',data:dataLucro,backgroundColor:'#4caf50'},{label:'Custo Ra√ß√£o (R$)',data:dataRacao,backgroundColor:'#ff9800'}]},options:{responsive:true,plugins:{legend:{position:'top',labels:{color:'white'}}},scales:{x:{ticks:{color:'white'}},y:{ticks:{color:'white'},beginAtZero:true}}}});
}

// Gr√°fico financeiro mensal
function atualizarGraficoFinanceiro(){
    const ctx=document.getElementById('graficoFinanceiro').getContext('2d');
    const meses={};
    lancamentos.forEach(l=>{
        const m=l.data.split('/')[1]+'/'+l.data.split('/')[2];
        if(!meses[m])meses[m]={entrada:0,saida:0,racao:0};
        if(l.gastoRacao)meses[m].racao+=l.valor;
        else if(l.tipo==='entrada')meses[m].entrada+=l.valor;
        else meses[m].saida+=l.valor;
    });
    const labels=Object.keys(meses);
    const dataEntrada=labels.map(l=>meses[l].entrada);
    const dataSaida=labels.map(l=>meses[l].saida);
    const dataRacao=labels.map(l=>meses[l].racao);
    if(window.graficoFinanceiroInstance) window.graficoFinanceiroInstance.destroy();
    window.graficoFinanceiroInstance=new Chart(ctx,{type:'bar',data:{labels,datasets:[{label:'Entradas',data:dataEntrada,backgroundColor:'#4caf50'},{label:'Sa√≠das',data:dataSaida,backgroundColor:'#f44336'},{label:'Ra√ß√£o',data:dataRacao,backgroundColor:'#ff9800'}]},options:{responsive:true,plugins:{legend:{position:'top',labels:{color:'white'}}},scales:{x:{ticks:{color:'white'}},y:{ticks:{color:'white'},beginAtZero:true}}}});
}

// ===============================
// Inicializa√ß√£o
// ===============================
document.addEventListener("DOMContentLoaded",function(){ mostrarTanques(); mostrarFinanceiro(); mostrarDashboard(); });

// ===============================
// Navega√ß√£o simples
// ===============================
const App={navigate:function(pageId){document.querySelectorAll(".page").forEach(p=>p.classList.remove("active")); document.getElementById(pageId).classList.add("active");}};
</script>

<style>
body{background:#0f1e38;color:white;font-family:sans-serif;margin:0;padding:0;}
header{background:#1e3a5f;padding:15px;text-align:center;}
nav{display:flex;justify-content:center;margin:10px 0;}
nav button{margin:0 5px;padding:10px 20px;background:#1e3a5f;color:white;border:none;border-radius:5px;cursor:pointer;}
nav button:hover{background:#274c7b;}
.page{display:none;padding:15px;}
.page.active{display:block;}
</style>

</body>
</html>
